# SIMPLE BBS Kit
## 0.ご利用の際の注意事項
本キットは素人による作成物です。  
動作確認済みのプログラムを公開しておりますが、想定外のバグが発生する可能性もございます。  
不具合によるデータの損傷等については何卒自己責任でご利用いただけますと幸いです。  
ご利用の際は、データ保護のためにも定期的なバックアップを取得することを推奨いたします。  
  
ご利用中に発生したバグや不具合については作成者までご連絡いただけますと大変有り難いです。  
今後の修正やアップデートの際に参考とさせていただきます。

## 1.概要
C-RES用簡易BBSキットです。  
BBS機能の他、簡易なプロフィール作成機能があります。

## 2.動作環境
下記の条件で動作することを確認しています。  
- PHP7.4.13(高速化設定済)

※CGIによるプログラムではありません。  
 お使いのレンタルサーバ等でPHPが動作することをご確認ください。

## 3.使い方
### 3.1.初回セットアップ
はじめて本キットを使用する場合は、下記に従ってセットアップしてください。

1. ページ上部の **Code** から **Download ZIP** を選択してZIPファイルを取得する。

2. ZIPファイルをローカルで展開し、**source/defined.php**をエディタで開いて編集する。

（例）用途に合わせて下記のように編集します
```php
<?php
/**
 * prodfile-edit.php
 * プロフィール登録画面における定数指定
 */

 /* 半角英数字で指定する */
define( 'SIDE_A', 'MAN' );
define( 'SIDE_B', 'WOMAN' );
/* 文章で指定する */
define( 'PCNAME_NOTICE', '苗字 名前の順で入力する' );
define( 'PCNAME_SPELL_NOTICE', '半角英字でスペルを入力する' );
define( 'ICON_NOTICE', '※100×100サイズオンリー' );

/**
 * admin.php
 * 管理者用メニューへのログインパスワード指定
 */

 /* 半角英数字で指定する */
 define( 'ADMIN_PASS', 'test12345' );
```

3. BBSを設置するサーバのルートディレクトリ直下に`bbs`という名称のディレクトリを作成する。

4. ３で作成したディレクトリ配下に、２で展開・編集済みの全てのファイルおよびディレクトリをアップロードする。

※ルートディレクトリから見たファイルの絶対パスが下記の通りになるようにファイルを設置します。  
※ファイルだけでなく、ディレクトリも必ずアップロードしてください。  
※下記以外のパスにファイルを設置しても、BBSは動作しません。

```
/bbs/index.html
/bbs/mainbbs.php
/bbs/profile.php
/bbs/README.md
/bbs/source/
/bbs/data/
/bbs/icon/
/bbs/icon/tmp/
...(以下略)
```

5. `http://<設置したサーバのドメイン名>/bbs/mainbbs?bbs_id=test`にアクセスし、**NEW POST**ボタンから新規投稿のテストを行う。

※上記URLでBBSが表示されない場合は、４でのファイルの設置場所に問題がある可能性があります。  

6. 正常に投稿できたら`/bbs/data/`配下の全てのCSVファイルを削除する。

7. `/bbs/icon/`および`/bbs/icon/tmp/`配下のJPGファイルを削除する。

### 3.2.各機能の説明
#### 3.2.1.PROFILE登録機能
`http://<設置したサーバのドメイン名>/bbs/profile-edit?type=register`

投稿フォームに内容を記載して送信すると、プロフィールを作成することができます。  
一度登録したプロフィールはADMIN機能から修正が可能です（後述）。  
なお、ここで設定するパスワードはBBSの投稿時に使用するため、PLごとに管理が必要となります。

#### 3.2.2.1PROFILE一覧・詳細ページ
`http://<設置したサーバのドメイン名>/bbs/profile-list`

PROFILE登録機能を使って登録したプロフィール情報の一覧をサイドごとに参照することができます。  
各プロフィールカードのインフォメーションボタン(i)をクリックすると、各プロフィールの詳細ページに遷移します。  

#### 3.2.3.コメント登録機能
`http://<設置したサーバのドメイン名>/bbs/profile?chara_id=xxxx(登録済のキャラクターID)`

プロフィールの詳細ページ上部のペン型アイコンをクリックすると、キャラクターごとのコメントを登録することができます。  
PCの一言を記載する欄などにご利用ください。  
なお、コメント登録時にパスワードの入力が必要となります。

#### 3.2.4.簡易ペア表
`http://<設置したサーバのドメイン名>/bbs/profile-list`

プロフィール一覧の下部に簡易なペア表を表示することができます。  
ペア表を表示する場合は、下記の手順に従ってリストを作成してください。  

1. `pairlist.csv`というファイルを作成し、ペアとなるIDの組み合わせを下記のフォーマットで記載します。

```csv
charainfo_1605336061,charainfo_1605336062
charainfo_1605336063,charainfo_1605336064
charainfo_1605336065,charainfo_1605336066
charainfo_1605336067,charainfo_1605336068
```

※ペアとなるIDの組み合わせをカンマで繋いで一行に記載します。  
※各PCのIDについては、プロフィールの詳細ページのURLを参照してください。  

（例）URLが`http://<設置したサーバのドメイン名>/bbs/profile?chara_id=charainfo_12345678`の場合、IDは`charainfo_12345678`

2. 作成した`pairlist.csv`をサーバ上の`/bbs/data/`配下にアップロードする。

3. プロフィール一覧ページを参照（要リロード）し、ペア表が表示されていることを確認する。

#### 3.2.5.BBS機能
`http://<設置したサーバのドメイン名>/bbs/mainbbs?bbs_id=xxx(任意の英数字)`

クエリパラメータ`bbs_id`に任意の英数字を指定してブラウザアクセスすると、任意のBBSページを作成することができます。  
BBSページは無制限で作成することができます。   

（例）`http://<設置したサーバのドメイン名>/bbs/mainbbs?bbs_id=room`というURLでアクセスすると、`room`というタイトルのBBSページが作成されます。  


各BBSページの**NEW POST**ボタンで新規スレッドを作成することができます。  
作成済みのスレッドは、タイトルおよび投稿者の名前が一覧で表示されます。  
スレッドのタイトルをクリックすると、各スレッドのページに遷移します。  
各スレッドページの**ADD POST**ボタンでスレッドに対してレスを投稿することができます。  
投稿時に選択できる投稿者情報は、PROFILE登録機能で登録済みのキャラクターのみとなります。また、投稿時にパスワードの入力が必要です。  
各レス下部にあるペン型アイコンで内容の編集、ゴミ箱アイコンでレスの削除をすることができます。  

#### 3.2.6.簡易報告掲示板機能
`http://<設置したサーバのドメイン名>/bbs/broadcast`

レス遅延等の報告掲示板として利用できる機能です。  
レスの遅延状況や簡易な伝言（１５字以内）を送信することができます。  
送信した報告内容は同じ画面内に一覧として表示されるほか、最新2日分の報告に関しては作成した各BBSページのトップにも表示されます。  
レス遅延の報告以外にも、管理人からの簡単な周知事項を記載するなどにも利用できます。

#### 3.2.7.ADMIN機能
`http://<設置したサーバのドメイン名>/bbs/admin`

管理人用ページです。  
このページから全ての登録済みプロフィールの内容修正を行うことができます。  
ADMIN PASSWORDについては、手順**3.1.初回セットアップ**内で指定したADMIN_PASSの値を使用します。

## 4.QA
### 4.1.エラー番号一覧

|エラー番号|文言|対処法|
|:--:|:--|:--:|
|N000|再操作してください。何度もエラーが出る場合はお問い合わせください。|-|
|N001|アップロード可能な拡張子はjpg, png, gifです。|-|
|N002|ファイルを選択してください。|-|
|N003|パスワードが間違っています。|-|
|F000|ファイルのアップロードに失敗しました。|項版4.2.1を参照|



### 4.2.エラー対処法
#### 4.2.1.ファイルのアップロードに失敗する
1. BBSフォルダ内にフォルダ **icon, icon/tmp** が存在することを確認してください。
```bash
bbs/
  ∟icon/
    ∟tmp/
  ...
```
2. フォルダ **icon, icon/tmp** に対し、書き込み権限があることを確認してください。  
フォルダへのアクセス権限の確認方法は、各レンタルサーバの仕様に従ってください。

## 5.改変したい方向け

### 5.1.デザインを変えたい場合
本BBSキットはBootstrapを利用してページデザインを作成しています。  
デザインを変更したい場合はBootstrapに関する最低限の知識が必要となりますこと、ご了承ください。  
また、デザインのみを変更する場合は`<?php ... ?>`で囲われた部分の記載の変更を行わないようにご注意ください。

### 5.2.BBS機能を改変したい場合
PHP部分の改変等はご自由に行ってください。

## 6.QA

### 6.1.プロフィール機能について
#### (1) プロフィールで設定したパスワードを忘れてしまった
ADMINページからプロフィール情報を修正する際、パスワードを上書き登録することができます。  
パスワードをお忘れの際はそちらから新規にパスワードを登録してください。